CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

PROJECT(ffsp)

SET(MKFS_BINARY "mkfs.ffsp")
SET(MOUNT_BINARY "mount.ffsp")

IF(NOT CMAKE_BUILD_TYPE)
    MESSAGE(STATUS "No build type selected. Default to Debug")
    SET(CMAKE_BUILD_TYPE "Debug")
ENDIF()

FILE(GLOB MKFS_SRC src/mkfs.ffsp.cpp)
FILE(GLOB MOUNT_SRC src/mount.ffsp.cpp)
FILE(GLOB FFSP_SRC src/libffsp/*.h src/libffsp/*.c)

# TODO: add full submodule
SET(SPDLOG_INCLUDE_DIRS "lib")

IF(WIN32)
    SET(FUSE_INCLUDE_DIRS "D:/Development/fs/dokany/dokan_fuse/include")
    SET(FUSE_LIBRARY_DIRS "D:/Development/fs/dokany/x64/Debug")
    SET(FUSE_LIBRARIES "dokanfuse")

    INCLUDE_DIRECTORIES(src/libffsp/win32)
    FILE(GLOB FFSP_SRC_WIN32 src/libffsp/win32/*.h src/libffsp/win32/*.c)
    SET(FFSP_SRC "${FFSP_SRC}" "${FFSP_SRC_WIN32}")

    ADD_DEFINITIONS(-DFUSE_USE_VERSION=26 -D_WIN32_WINNT=0x0601)
    ADD_DEFINITIONS(-D_CRT_NONSTDC_NO_DEPRECATE -D_CRT_SECURE_NO_WARNINGS /W4)
ELSE()
    SET(FUSE_INCLUDE_DIRS "/usr/include/fuse")
    SET(FUSE_LIBRARIES "fuse" "pthread")

    ADD_DEFINITIONS(-DFUSE_USE_VERSION=26 -D_FILE_OFFSET_BITS=64)
    ADD_DEFINITIONS(-std=gnu++14 -Wall -Wextra -pedantic)
ENDIF()

INCLUDE_DIRECTORIES(${FUSE_INCLUDE_DIRS} ${SPDLOG_INCLUDE_DIRS})
LINK_DIRECTORIES(${FUSE_LIBRARY_DIRS})

ADD_EXECUTABLE(${MKFS_BINARY} ${MKFS_SRC} ${FFSP_SRC})
TARGET_LINK_LIBRARIES(${MKFS_BINARY} pthread)

ADD_EXECUTABLE(${MOUNT_BINARY} ${MOUNT_SRC} ${FFSP_SRC})
TARGET_LINK_LIBRARIES(${MOUNT_BINARY} ${FUSE_LIBRARIES})
